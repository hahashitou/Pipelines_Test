<h1 id="putting-it-all-together">Putting it All Together</h1>
<h2 id="progress-diagram">Progress Diagram</h2>
<figure>
<img
src="https://serverlessoh.azureedge.net/public/final-progress-diagram.jpg"
alt="Final progress diagram" />
<figcaption aria-hidden="true">Final progress diagram</figcaption>
</figure>
<h2 id="happy-path">Happy Path</h2>
<ul>
<li>Change feed + Functions to forward to a new Event Hub, or modify
CreateRating function with a new second output binding to Event Hub</li>
<li>Create Stream Analytics solution with original POS Event Hubs &amp;
new new Event Hub as input</li>
<li>Write one or more Stream Insight queries then output to Cosmos or to
PowerBI. Example:</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Products AS (</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    Select <span class="op">*</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    from testdata as t</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CROSS</span> APPLY GetArrayElements(t.items) AS flat</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>SELECT System.TimeStamp AS WindowEnd,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        T.<span class="kw">header</span>.locationname,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        flat.ArrayValue.productname,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        sum(flat.ArrayValue.totalcost) as totalCost,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">count</span>(<span class="dv">1</span>) as countUnits</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>INTO prodPowerBi</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>FROM Products</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>GROUP BY flat.ArrayValue.productname, T.<span class="kw">header</span>.locationname, TumblingWindow(<span class="kw">minute</span>, <span class="dv">5</span>)</span></code></pre></div>
<h2 id="why-azure-functions-and-stream-analytics">Why Azure Functions
and Stream Analytics</h2>
<h3 id="azure-functions">Azure Functions</h3>
<ul>
<li>Azure functions allow your teams to write less code, maintain less
infrastructure and save on costs.</li>
<li>Azure functions are lightweight and stand-alone. Functions can
easily break up monolithic applications and reduce your lead/cycle time,
allowing your teams to get code to production much more quickly and
efficiently.</li>
</ul>
<h3 id="azure-stream-analytics">Azure Stream Analytics</h3>
<ul>
<li>Easily build an end-to-end analytics pipeline, using queries to
translate and filter data</li>
<li>Built-in machine learning capabilities provide advanced
solutions</li>
</ul>
