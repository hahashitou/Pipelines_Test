<h1 id="finish-the-ice-cream-ratings-api">Finish the Ice Cream Ratings
API</h1>
<h2 id="background">Background</h2>
<p>Best For You Organics Company (BFYOC) has begun creation of a mobile
application and public facing website, both of which will be used by
customers to submit ratings and feedback of their ice cream. Both the
website and application will be calling a set of APIs. BFYOC would like
your team to create APIs to allow customers to submit ratings, and for
business users to retrieve the ratings for reporting purposes.</p>
<p>Itâ€™s difficult to predict the load generated by user reviews which
can be impacted by several factors. Introduction or cancellation of a
flavor will cause a spike in reviews, as will local events, like
concerts or an unexpected heatwave. As a result, the solution you
implement must be able to scale dynamically, and minimize costs whenever
possible.</p>
<p>BFYOC would like to ensure that the proper engineering fundamentals
are implemented from the beginning of the application development and
want to ensure the team establishes a pipeline where updates are <a
href="https://docs.microsoft.com/azure/devops/learn/what-is-continuous-integration/">integrated</a>
and <a
href="https://docs.microsoft.com/azure/devops/learn/what-is-continuous-delivery/">deployed</a>
continuously. For compliance reasons, they also need to be able to track
changes, and rollback any deployments as necessary.</p>
<h2 id="challenge">Challenge</h2>
<h3 id="setup">Setup</h3>
<p>Your team has been asked to implement a solution that will
automatically deploy the Ratings API. The solution needs to include a
process to revert to a previous (code) commit and redeploy, as well as
tracking all changes made to the code.</p>
<p>Your solution should handle automatically building the code every
time it is checked/merged in to the <code>master</code> branch and
generate an artifact that can be deployed. Assuming the build succeeds
and applicable unit tests pass, the artifact should then be
automatically deployed to an instance of your Ratings API.</p>
<p>Take this opportunity to discuss as a team how you will be working as
team. Implement the appropriate branching strategies that will enable
collaboration.</p>
<h3 id="api-development">API Development</h3>
<p>This challenge will require information about Users and Products.
Three APIs have already been created for getting info about Users and
Products:</p>
<ul>
<li><a
href="https://serverlessohapi.azurewebsites.net/api/GetProducts">Get
Products</a></li>
<li><a
href="https://serverlessohapi.azurewebsites.net/api/GetProduct?productId=75542e38-563f-436f-adeb-f426f1dabb5c">Get
Product</a> (expects a <code>productId</code> query parameter in the
URL)</li>
<li><a href="https://serverlessohapi.azurewebsites.net/api/GetUsers">Get
Users</a></li>
<li><a
href="https://serverlessohapi.azurewebsites.net/api/GetUser?userId=cc20a6fb-a91f-4192-874d-132493685376">Get
User</a> (expects a <code>userId</code> query parameter in the URL)</li>
</ul>
<p>You now should work together as a team to create an Azure Function
App in your Azure subscription that will implement the Ice Cream Ratings
part of the API.</p>
<p>Your challenge is to define, create and deploy three functions in
this function app:</p>
<h4 id="createrating">CreateRating</h4>
<ul>
<li><strong>Verb</strong>: POST</li>
<li><strong>Input payload example</strong>:</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;cc20a6fb-a91f-4192-874d-132493685376&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;4c25613a-a3c2-4ef3-8e02-9c335eb23204&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;locationName&quot;</span><span class="fu">:</span> <span class="st">&quot;Sample ice cream shop&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;userNotes&quot;</span><span class="fu">:</span> <span class="st">&quot;I love the subtle notes of orange in this ice cream!&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><strong>Requirements</strong>
<ul>
<li>Validate both <code>userId</code> and <code>productId</code> by
calling the existing API endpoints. You can find a user id to test with
from the sample payload above</li>
<li>Add a property called <code>id</code> with a GUID value</li>
<li>Add a property called <code>timestamp</code> with the current UTC
date time</li>
<li>Validate that the <code>rating</code> field is an integer from 0 to
5</li>
<li>Use a data service to store the ratings information to the
backend</li>
<li>Return the entire review JSON payload with the newly created
<code>id</code> and <code>timestamp</code></li>
</ul></li>
<li><strong>Output payload example</strong>:</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2779e-dd2e-43e8-803d-ecbebed8972c&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;cc20a6fb-a91f-4192-874d-132493685376&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;4c25613a-a3c2-4ef3-8e02-9c335eb23204&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2018-05-21 21:27:47Z&quot;</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;locationName&quot;</span><span class="fu">:</span> <span class="st">&quot;Sample ice cream shop&quot;</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;userNotes&quot;</span><span class="fu">:</span> <span class="st">&quot;I love the subtle notes of orange in this ice cream!&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="getrating">GetRating</h4>
<ul>
<li><strong>Verb</strong>: GET</li>
<li><strong>Query string or route parameter</strong>:
<code>ratingId</code></li>
<li><strong>Requirements</strong>
<ul>
<li>Get the rating from your database and return the entire JSON payload
for the review identified by the id</li>
<li>Additional route parameters or query string values may be used if
necessary.</li>
</ul></li>
<li><strong>Output payload example</strong>:</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2779e-dd2e-43e8-803d-ecbebed8972c&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;cc20a6fb-a91f-4192-874d-132493685376&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;4c25613a-a3c2-4ef3-8e02-9c335eb23204&quot;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2018-05-21 21:27:47Z&quot;</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;locationName&quot;</span><span class="fu">:</span> <span class="st">&quot;Sample ice cream shop&quot;</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;userNotes&quot;</span><span class="fu">:</span> <span class="st">&quot;I love the subtle notes of orange in this ice cream!&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="getratings">GetRatings</h4>
<ul>
<li><strong>Verb</strong>: GET</li>
<li><strong>Query string or route parameter</strong>:
<code>userId</code></li>
<li><strong>Requirements</strong>
<ul>
<li>Get the ratings for the user from your database and return the
entire JSON payload for the reviews for the user identified by the
id.</li>
<li>Additional route parameters or query string values may be used if
necessary.</li>
</ul></li>
<li><strong>Output payload example</strong>:</li>
</ul>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2779e-dd2e-43e8-803d-ecbebed8972c&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;cc20a6fb-a91f-4192-874d-132493685376&quot;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;4c25613a-a3c2-4ef3-8e02-9c335eb23204&quot;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2018-05-21 21:27:47Z&quot;</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;locationName&quot;</span><span class="fu">:</span> <span class="st">&quot;Sample ice cream shop&quot;</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userNotes&quot;</span><span class="fu">:</span> <span class="st">&quot;I love the subtle notes of orange in this ice cream!&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;8947f7cc-6f4c-49ed-a7aa-62892eac8f31&quot;</span><span class="fu">,</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;cc20a6fb-a91f-4192-874d-132493685376&quot;</span><span class="fu">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;e4e7068e-500e-4a00-8be4-630d4594735b&quot;</span><span class="fu">,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2018-05-20 09:02:30Z&quot;</span><span class="fu">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;locationName&quot;</span><span class="fu">:</span> <span class="st">&quot;Another Sample Shop&quot;</span><span class="fu">,</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userNotes&quot;</span><span class="fu">:</span> <span class="st">&quot;I really enjoy this grape ice cream!&quot;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>Besides tools like Curl and Postman, you can use <a
href="https://softserverless-rating.trafficmanager.net/">the Rating Test
Website</a> to test your CreateRating method.</p>
<p><strong>Hint</strong>: If using the Rating Test Website make sure to
add the <a
href="https://softserverless-rating.trafficmanager.net/">https://softserverless-rating.trafficmanager.net/</a>
website url to your functionâ€™s CORS rules!</p>
<h2 id="success-criteria">Success Criteria</h2>
<ul>
<li><p>Have the rating API functionsâ€™ code in source control</p></li>
<li><p>Demonstrate a working CI/CD pipeline for your teamâ€™s
coaches</p></li>
<li><p>Provide your coach the three endpoint URLs. The coach should be
able to make a call to each of the endpoints and get successful
results</p></li>
<li><p>The coach should be able to use <code>GetRating</code> and
<code>GetRatings</code> to query for ratings that the coach creates with
<code>CreateRating</code></p></li>
<li><p>The endpoints should return standard HTTP status codes. For
example, 404 when items are not found.</p></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a
href="https://docs.microsoft.com/devops/develop/what-is-continuous-integration">What
is Continuous Integration?</a></li>
<li><a
href="https://docs.microsoft.com/devops/deliver/what-is-continuous-delivery">What
is Continuous Delivery?</a></li>
<li><a
href="https://docs.microsoft.com/azure/azure-functions/functions-continuous-deployment">Continuous
deployment for Azure Functions</a></li>
<li><a
href="https://docs.microsoft.com/azure/devops/pipelines/get-started/?view=azure-devops">Azure
DevOps Pipelines</a></li>
<li><a
href="https://github.com/marketplace/actions/azure-functions-action">Git
Actions Azure Functions Action</a></li>
<li><a
href="https://docs.microsoft.com/azure/jenkins/jenkins-azure-functions-deploy">Deploy
Azure Functions with Jenkins</a></li>
<li><a href="https://octopus.com/blog/azure-functions">Deploy Azure
Functions with Octopus Deploy</a></li>
<li>Review the <a
href="https://docs.microsoft.com/azure/azure-functions/supported-languages">Supported
Languages in Azure Functions</a> guide and go into the specific guide
for the language you are using</li>
<li><a
href="https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings">Azure
Functions triggers and bindings concepts</a></li>
<li><a
href="https://docs.microsoft.com/azure/cosmos-db/introduction">Introduction
to Cosmos DB</a></li>
<li><a
href="https://docs.microsoft.com/azure/azure-functions/functions-bindings-cosmosdb-v2">Azure
Cosmos DB bindings for Azure Functions</a></li>
<li><a
href="https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook">Azure
Functions HTTP and webhook bindings</a></li>
<li><a
href="https://docs.microsoft.com/azure/azure-functions/functions-integrate-store-unstructured-data-cosmosdb">Store
unstructured data using Azure Functions and Azure Cosmos DB</a></li>
<li><a
href="https://docs.microsoft.com/azure/sql-database/sql-database-json-features">Getting
started with JSON features in Azure SQL Database</a></li>
<li><a
href="https://docs.microsoft.com/azure/cosmos-db/table-storage-overview">Azure
Table storage overview</a></li>
</ul>
<h2 id="progress-diagram">Progress Diagram</h2>
<figure>
<img
src="https://serverlessoh.azureedge.net/public/ratings-api-progress-diagram.jpg"
alt="Ratings API progress diagram" />
<figcaption aria-hidden="true">Ratings API progress diagram</figcaption>
</figure>
